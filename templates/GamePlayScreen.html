<!-- lizbet rivera created basic player entry page -->


<!DOCTYPE html>
<html>


<head>
<link rel="stylesheet" href="{{ url_for('static', filename='css/GamePlayScreen.css')}}">
<title>Entry Terminal</title>
</head>

<body>
<h2></h2>
<p>{{ message }}</p>
<div class="flex-teams">
    <div class="flex-child red-team">
        <p class="red_team_text">RED
            TEAM<br>SCORE:000<br>TEAM MEMBERS:<br>
            <ul class="red_team_text">
                {% if red_team %}
                    {% for name in red_team %}
                        <p>{{ name }}</p>
                    {% endfor %}
                {% else %}
                    {% for name in fh %}
                    <p>{{ name }}</p>
                    {% endfor %}
                {% endif %}
            </ul>
    </div>
    <div class="flex-child green-team">
        <p class="green_team_text">GREEN TEAM<br>SCORE: 000<br>TEAM
            MEMBERS:<br>
            <ul class="green_team_text">
                {% if green_team %}
                    {% for name in green_team %}
                        <p>{{ name }}</p>
                    {% endfor %}
                {% else %}
                    {% for name in sh %}
                    <p>{{ name }}</p>
                    {% endfor %}
                {% endif %}
            </ul>
    </div>
</div>

<div class = "countdown-section">
    <p style="color: white; font-family:'Courier New'">Time Left:</p>
    <p style="color: white; font-family:'Courier New'" id ="countdown"></p>
</div>

<div class="Play-by-Play">
    <p style="color: white; font-family:'Courier New'"><b>PLAY BY PLAY</b></p>
    <p style="color: white; font-family:'Courier New'" id ="playerWhoShot"></p>
    <p style="color: white; font-family:'Courier New'"> shot </p>
    <p style="color: white; font-family:'Courier New'" id = "playerHit"></p>
</div>



<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
<script type="text/javascript">
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    socket.on('update', function(message) {
        console.log(message);
        // Add code here to update the HTML with the message
    });
    function countdown() {
    const minutes = Math.floor(time / 60);
    let seconds = time % 60;
    seconds = seconds < 10 ? '0' + seconds : seconds;

    if (time == -1) {
        clearTimeout(timerId);
        if(sixTimer == "false"){
            sixMinTimer();
            player_actions();
        }
    } 
    else {
        elem.innerHTML = `${minutes}:${seconds}`;;
        time--;
    }
}

function sixMinTimer(){
    sixTimer = "true"
    startingMin = 6;
    time = startingMin * 60;
    timerId = setInterval(countdown, 1000);
}

function get_player_fired(id){ 
    //variable to return player that fired the shot
    var playerFired = "";

    //do XML request to the database
    var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            playerFired = this.codename; //return the codename of player to the return string value
        }
      };
      xhr.open("GET", "http://your-server-url-here.com/get-data?id=" + id, true); //I DONT KNOW THE SERVER URL OR HOW TO ACCESS IT BUT HERE IS A GENERAL QUERY AS PLACEHOLDER
      xhr.send();

      return playerFired;
}

function get_player_shot(id){ 
    //variable to return player that fired the shot
    var playerShot = "";

    //do XML request to the database
    var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            playerShot = this.codename; //return the codename of player to the return string value
        }
      };
      xhr.open("GET", "http://your-server-url-here.com/get-data?id=" + id, true);
      xhr.send();

      return playerShot;
}

function player_actions(){
    //----------------HERE IS THE PLAYER ID STRING SENT FROM THE PYTHON FILE-----------------------
    //var message = input from python file; 
    
    //split up message and change to int to grab ID with
    const playersArray = message.split(":");
    var id_player_fired = parseInt(playersArray[0]);
    var id_player_shot = parseInt(playersArray[1]);
    
    document.getElementById("playerWhoShot") = get_player_fired(id_player_fired);
    document.getElementById("playerHit") = get_player_shot(id_player_shot);    
}

var elem = document.getElementById('countdown');   
startingMin = 0.5;
time = startingMin * 60;
timerId = setInterval(countdown, 1000);
sixTimer = "false"
</script>


</body>
</html>